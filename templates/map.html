<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>航法計画作成支援システム</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/map.css') }}" />
</head>
<body>
  <div id="container">
    <div id="map"></div>
    <div id="sidebar">
      <div id="tabs">
        <button class="tab-btn" onclick="window.showTab('results')">計算結果</button>
      </div>

      <div id="inputTab">
        <div class="mode-switch">
          <button id="mode-text" class="active" onclick="window.setRouteMode('text')">地名入力</button>
          <button id="mode-pick" onclick="window.setRouteMode('pick')">地図クリック</button>
        </div>
        <div class="mode-hint" id="modeHint">現在：地名入力モード</div>

        <div id="text-route-panel">
          <div class="input-group">
            <label>出発地:</label>
            <input type="text" id="start" placeholder="例：RJTT">
          </div>
          <div id="waypoints"></div>
          <button onclick="window.addWaypoint()" style="width:100%; padding:6px; margin-bottom:10px;">＋ 経由地を追加</button>
          <div class="input-group">
            <label>目的地:</label>
            <input type="text" id="end" placeholder="例：RJCJ">
          </div>
        </div>

        <div id="pick-route-panel" style="display:none;">
          <div class="input-group">
            <label>地図上の地点をクリックして追加</label>
          </div>
          <div id="pickedList"></div>
          <div style="display:flex; gap:6px; margin-top:6px;">
            <button onclick="window.undoPick()" style="flex:1; padding:6px;">一つ戻す</button>
            <button onclick="window.clearPick()" style="flex:1; padding:6px;">全消去</button>
          </div>
        </div>

        <hr style="margin:20px 0; border:0; border-top:1px solid #ccc;">
        
        <div class="input-group">
          <label>真対気速度 (TAS, kt)：</label>
          <input type="number" id="tas" value="120" min="10">
        </div>
        <div class="input-group">
          <label>飛行高度 (ft)：</label>
          <input type="number" id="alt" value="3000" min="0" step="500">
        </div>
        <div class="input-group">
          <label>外気温 (OAT, ℃)：</label>
          <input type="number" id="oat" placeholder="例：15" step="1">
        </div>
        <div class="input-group">
          <label>計器速度 (IAS, kt)：</label>
          <input type="number" id="ias" placeholder="例：110" min="0" step="1">
        </div>
        <div class="input-group">
          <label>出発予定時刻 (ETD)：</label>
          <input type="time" id="etd">
        </div>
        <div class="input-group">
          <label>風向 / 風速(kt)：</label>
          <div style="display:flex; gap:8px;">
            <input type="number" id="windDir" placeholder="Deg" min="0" max="359">
            <input type="number" id="windSpd" placeholder="Kt" min="0">
          </div>
        </div>
        <div class="input-group">
          <label>自差 (DEV)：</label>
          <input type="number" id="dev" value="0" step="0.1">
        </div>
        <div class="input-group">
          <label>燃料消費率 (gal/h)：</label>
          <input type="number" id="burnPerHour" value="30" step="0.1">
        </div>
        <div class="input-group">
          <label>積載燃料 (gal)：</label>
          <input type="number" id="startFuel" value="100" step="0.1">
        </div>

        <div id="actionBar">
          <button id="plot-button-bar" onclick="window.plotRoute()">NavLog 作成</button>
          <button id="pick-run-bar" onclick="window.plotRouteFromPicked()" disabled style="display:none;">NavLog 作成</button>
          <button id="reset-button" onclick="window.resetAll()">リセット</button>
        </div>
        <div id="credits-link" style="margin-top:20px; text-align:center; font-size:12px;">
          <a href="{{ url_for('credits') }}" target="_blank">出典・ライセンス</a>
        </div>
      </div>

      <div id="resultsTab" style="display:none;">
        <div class="results-toolbar">
          <button class="btn-back" onclick="window.showTab('input')">◀ 条件入力へ戻る</button>
          <button class="btn-print" onclick="window.print()">🖨 印刷 </button>
        </div>
        <div id="results"></div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="{{ url_for('static', filename='js/map-core.js') }}"></script>
  <script src="{{ url_for('static', filename='js/camera-layer.js') }}"></script>
  <script src="{{ url_for('static', filename='js/weather-imc.js') }}"></script>
  <script src="{{ url_for('static', filename='js/gfs-wind.js') }}"></script>
  <script src="{{ url_for('static', filename='js/navlog.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui-main.js') }}"></script>
</body>
</html>